# AI in Action - GeneInsight Demo

This project demonstrates a workflow for annotating genetic variants from a VCF file, with a focus on lung adenocarcinoma-related genes and HPO terms. It includes a Python backend script for data processing and a web-based frontend for interactive demonstration.

## Components

1.  **`annotate_vcf_advanced.py`**: A Python script that:
    *   Parses VCF files.
    *   Annotates variants using MyVariant.info.
    *   Assesses pathogenicity based on simplified ACMG guidelines, ClinVar, and gnomAD frequencies.
    *   Stores annotated variants in a MongoDB database.
    *   Generates a simulated gene report.
2.  **`gene_demo.html`**: An HTML file that provides a user interface to:
    *   Simulate uploading a VCF file.
    *   Select HPO terms.
    *   View simulated pathogenic variants.
    *   View a simulated gene report.
    *   Uses a public HPO API for term autocompletion.
3.  **`requirements.txt`**: Lists the Python dependencies for the backend script.
4.  **`HG001_GRCh38_1_22_v4.2.1_benchmark.vcf.gz`**: A sample VCF file used by default if no other file is specified in `gene_demo.html` or if `annotate_vcf_advanced.py` is run directly without modifications to its default VCF path.
5.  **`na12878_sample.vcf`**: Another sample VCF file.

## Prerequisites

*   Python 3.x
*   pip (Python package installer)
*   A MongoDB instance (local or cloud-based like MongoDB Atlas)
*   A modern web browser (for `gene_demo.html`)

## Setup

1.  **Clone the repository (if applicable) or ensure you have the project files.**

2.  **Navigate to the `AI in action` directory:**
    ```bash
    cd /path/to/your/project/gene-idea/AI in action
    ```

3.  **Create and activate a Python virtual environment (recommended):**
    The project appears to contain a pre-existing virtual environment structure within the `AI in action` directory (`bin`, `lib`, `include`, `pyvenv.cfg`). You can try to activate it:
    ```bash
    source bin/activate  # On Windows use `Scripts\activate` if a similar structure exists
    ```
    If this doesn't work or you prefer a new environment:
    ```bash
    python3 -m venv venv_new  # Create a new one, e.g., named venv_new
    source venv_new/bin/activate
    ```

4.  **Install Python dependencies:**
    ```bash
    pip install -r requirements.txt
    ```

5.  **Configure MongoDB:**
    *   Open `annotate_vcf_advanced.py`.
    *   Locate the `MONGO_URI` variable (around line 15).
    *   Replace the placeholder `"mongodb+srv://<username>:<password>@cluster0.abcde.mongodb.net/?retryWrites=true&w=majority"` with your actual MongoDB connection string.
    *   You can also change `DB_NAME` and `COLLECTION_NAME` if needed.

## Running the Project

### 1. Backend Script (`annotate_vcf_advanced.py`)

This script processes a VCF file and stores results in MongoDB.

*   **To run with the default VCF file (`HG001_GRCh38_1_22_v4.2.1_benchmark.vcf.gz` or a generated dummy if not found):**
    Ensure your MongoDB is running and the `MONGO_URI` in the script is correctly configured.
    ```bash
    python annotate_vcf_advanced.py
    ```
    The script will:
    *   Connect to MongoDB.
    *   Parse the VCF file specified by `VCF_FILE_PATH` (defaults to `HG001_GRCh38_1_22_v4.2.1_benchmark.vcf.gz`). If this file is not found, it will attempt to create a small dummy gzipped VCF file with the same name for demonstration purposes.
    *   Annotate variants and store them in the configured MongoDB collection.
    *   Print a simulated MedGemma report to the console for pathogenic/likely pathogenic variants found.

*   **To process a different VCF file:**
    Modify the `VCF_FILE_PATH` variable in `annotate_vcf_advanced.py` (around line 19) to point to your desired VCF file. Then run the script as above.

### 2. Frontend Demo (`gene_demo.html`)

This HTML file provides an interactive web interface that simulates the variant annotation workflow. It operates client-side and uses pre-defined data for simulation.

*   **How to run:**
    Open the `gene_demo.html` file directly in your web browser (e.g., by double-clicking it or using "Open with..." your browser).
    Example path if your project is in `/workspaces/gene-idea/`:
    ```
    file:///workspaces/gene-idea/AI in action/gene_demo.html
    ```

*   **Features:**
    *   **Step 1:** Upload a VCF file (uses a default demo file if none is selected) and select/input HPO terms (with autocompletion from `hpo.jax.org`). Default HPO terms related to lung cancer are pre-selected.
    *   **Step 2:** View simulated clinically annotated variants based on the selected HPO terms and VCF file. The variant data and filtering logic are simulated within the JavaScript of the HTML file.
    *   **Step 3:** View a simulated gene report generated by a conceptual "MedGemma" model.

## Testing

### Backend (`annotate_vcf_advanced.py`)

*   **Automatic Dummy VCF:** If the VCF file specified by `VCF_FILE_PATH` is not found, the script automatically creates a small, gzipped dummy VCF file named `HG001_GRCh38_1_22_v4.2.1_benchmark.vcf.gz`. This allows the script to run and demonstrate its processing pipeline even without a specific input VCF.
*   **MongoDB Output:** After running the script, check your MongoDB instance (using MongoDB Compass, Atlas UI, or a mongo shell) for the database (`genomic_data` by default) and collection (`na12878_lung_cancer_variants` by default) to see the inserted annotated variants.
*   **Console Report:** Observe the console output for logs and the simulated MedGemma report.

### Frontend (`gene_demo.html`)

*   **Interactive Workflow:**
    1.  Open `gene_demo.html` in a browser.
    2.  **Step 1:**
        *   Try *not* selecting a VCF file to use the default.
        *   Try uploading one of the provided VCF files (e.g., `na12878_sample.vcf` or `HG001_GRCh38_1_22_v4.2.1_benchmark.vcf.gz`).
        *   Add or remove HPO terms using the input field and tags. Test the autocompletion.
        *   Click "Next: Annotate Variants".
    3.  **Step 2:**
        *   Observe the displayed pathogenic variants. The data is simulated in JavaScript.
        *   Verify that the displayed VCF filename and HPO terms match your selections.
        *   Click "Next: Generate Gene Report".
        *   Try the "Back" button.
    4.  **Step 3:**
        *   Observe the simulated gene report.
        *   Try the "Start Over" and "Back" buttons.
*   **Developer Console:** Open your browser's developer console (usually F12) to check for any JavaScript errors or network requests (e.g., to the HPO API).

This provides a basic way to test the functionality of both components. For more rigorous testing, you would typically develop specific unit tests for Python functions and potentially UI automation tests for the HTML interface.